(this["webpackJsonpmanga-tracker"]=this["webpackJsonpmanga-tracker"]||[]).push([[0],{67:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n(30),r=n.n(a),i=n(33),s=n(8),o=n(11),l=n.n(o),j=n(7),u=function(e){var t=Object(c.useState)(""),n=Object(s.a)(t,2),a=n[0],r=n[1];return{type:e,value:a,onChange:function(e){r(e.target.value)},onSubmit:function(){r("")}}},d=function(){var e=JSON.parse(localStorage.getItem("loggedInUser"));return{headers:{Authorization:"bearer ".concat(e.token)}}},b=function(e){var t=new Date,n=new Date(e).getTime(),c=(t.getTime()-n)/1e3;return c<60?"just now":c<3600?"".concat(Math.floor(c/60)," minute(s) ago"):c<86400?"".concat(Math.floor(c/3600)," hour(s) ago"):c<2592e3?"".concat(Math.floor(c/86400)," day(s) ago"):c<31104e3?"".concat(Math.floor(c/2592e3)," month(s) ago"):"".concat(Math.floor(c/31104e3)," year(s) ago")},h=n(70),O=n(1),x={textAlign:"center"},f=function(e){var t=Object(c.useState)(""),n=Object(s.a)(t,2),a=n[0],r=n[1],i=Object(c.useState)(!1),o=Object(s.a)(i,2),f=o[0],g=o[1],p=Object(c.useState)(!1),v=Object(s.a)(p,2),m=v[0],S=v[1],C=u("text"),k=u("text"),w="/api/manga";Object(c.useEffect)((function(){r(a||e.manga)}),[e,a]);var y=d(),U=function(t){if(t.preventDefault(),"<"===t.target.outerText){var n=Object(j.a)(Object(j.a)({},a),{},{chapter:a.chapter-=1});r(n),l.a.put(w,n,y).then((function(t){r(t.data),e.alert("".concat(t.data.title," moved to previous chapter"))})).catch((function(t){e.alert("Error: ".concat(t))}))}else if(">"===t.target.outerText){var c=Object(j.a)(Object(j.a)({},a),{},{chapter:a.chapter+=1,lastRead:new Date});r(c),l.a.put(w,c,y).then((function(t){r(t.data),e.alert("".concat(t.data.title," moved to next chapter"))})).catch((function(t){e.alert("Error: ".concat(t))}))}},D=function(e){e.preventDefault(),g(!f)},T=function(e){e.preventDefault(),S(!m)};return Object(O.jsxs)("tr",{style:x,children:[Object(O.jsx)("td",{children:a.title||"none"}),Object(O.jsx)("td",{children:b(a.lastRead)}),Object(O.jsxs)("td",{children:[Object(O.jsx)(h.a,{onClick:U,children:"<"}),"\xa0",a.chapter,"\xa0",Object(O.jsx)(h.a,{onClick:U,children:">"})]}),Object(O.jsx)("td",{children:f?Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)("form",{onSubmit:function(t){t.preventDefault();var n=Object(j.a)(Object(j.a)({},a),{},{link:C.value});l.a.put(w,n,y).then((function(t){r(t.data),C.onSubmit(),g(!f),e.alert("Changed link for ".concat(a.title))})).catch((function(t){e.alert("Error: ".concat(t))}))},children:["link: ",Object(O.jsx)("input",Object(j.a)({},C)),Object(O.jsx)(h.a,{type:"submit",children:"Update"}),Object(O.jsx)(h.a,{onClick:D,children:"Cancel"})]})}):Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("a",{href:String(a.link),children:"Go"}),Object(O.jsx)(h.a,{onClick:D,children:"Update"})]})}),Object(O.jsx)("td",{children:m?Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)("form",{onSubmit:function(t){t.preventDefault();var n=Object(j.a)(Object(j.a)({},a),{},{notes:k.value});l.a.put(w,n,y).then((function(t){r(t.data),k.onSubmit(),S(!m),e.alert("Updated notes for ".concat(a.title))})).catch((function(t){e.alert("Error: ".concat(t))}))},children:[Object(O.jsx)("input",{type:k.type,onChange:k.onChange,onSubmit:k.onSubmit,defaultValue:a.notes}),Object(O.jsx)(h.a,{type:"submit",children:"Update"}),Object(O.jsx)(h.a,{onClick:T,children:"Cancel"})]})}):Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)("p",{children:[a.notes,Object(O.jsx)(h.a,{onClick:T,children:"Update"})]})})}),Object(O.jsx)("td",{children:Object(O.jsxs)("select",{onChange:function(t){if(t.preventDefault(),window.confirm("Are you sure you want to mark ".concat(a.title," as ").concat(t.target.value))){var n=Object(j.a)(Object(j.a)({},a),{},{status:t.target.value});l.a.put(w,n,y).then((function(n){r(n.data),e.alert("Setting ".concat(a.title," status to ").concat(t.target.value))})).catch((function(t){e.alert("Error: ".concat(t))}))}},children:[Object(O.jsx)("option",{value:a.status,children:a.status}),"reading"===a.status?null:Object(O.jsx)("option",{value:"reading",children:"reading"}),"finished"===a.status?null:Object(O.jsx)("option",{value:"finished",children:"finished"}),"to start"===a.status?null:Object(O.jsx)("option",{value:"to start",children:"to start"}),"on hold"===a.status?null:Object(O.jsx)("option",{value:"on hold",children:"on hold"})]})})]})},g=n(69),p=function(e){var t=e.add,n=Object(c.useState)(!1),a=Object(s.a)(n,2),r=a[0],i=a[1],o=u("text"),l=u("text"),d=function(){return Object(O.jsx)(h.a,{onClick:function(e){e.preventDefault(),i(!r)},children:r?"Close":"Add Manga"})};return Object(O.jsxs)("div",{children:[Object(O.jsx)(d,{}),r?Object(O.jsx)(g.a,{onSubmit:function(e){e.preventDefault(),t({title:o.value,link:l.value}),o.onSubmit(),l.onSubmit(),i(!r)},children:Object(O.jsxs)(g.a.Group,{children:[Object(O.jsx)(g.a.Label,{children:"title:"}),Object(O.jsx)(g.a.Control,Object(j.a)({},o)),Object(O.jsx)("br",{}),Object(O.jsx)(g.a.Label,{children:"link:"}),Object(O.jsx)(g.a.Control,Object(j.a)({},l)),Object(O.jsx)("br",{}),Object(O.jsx)(h.a,{type:"submit",children:"Add"})]})}):null]})},v=function(e){var t=e.message;return Object(O.jsx)("div",{children:t?Object(O.jsx)("h3",{children:t}):null})},m=function(e){var t=e.data,n=e.vis,c=t.reduce((function(e,t){return e+t.chapter}),0),a=t.length,r=t.filter((function(e){return"finished"===e.status})).length,i=t.filter((function(e){return"reading"===e.status})).length;return Object(O.jsx)("div",{children:n?Object(O.jsxs)("div",{children:[Object(O.jsxs)("p",{children:["Chapters read: ",c]}),Object(O.jsxs)("p",{children:["Mangas in collection: ",a]}),Object(O.jsxs)("p",{children:["Mangas finished: ",r]}),Object(O.jsxs)("p",{children:["Mangas current reading: ",i]})]}):null})},S=function(e){var t=e.setSorter,n=e.sorter;return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("label",{children:"Sort by:"}),Object(O.jsxs)("select",{value:n,onChange:function(e){e.preventDefault(),t(e.target.value)},children:[Object(O.jsx)("option",{value:"timedes",children:"Time descending"}),Object(O.jsx)("option",{value:"timeasc",children:"Time ascending"}),Object(O.jsx)("option",{value:"namedes",children:"Name descending"}),Object(O.jsx)("option",{value:"nameasc",children:"Name ascending"})]})]})},C=function(e,t,n){switch(e){case"timedes":return new Date(n.lastRead).getTime()-new Date(t.lastRead).getTime();case"timeasc":return new Date(t.lastRead).getTime()-new Date(n.lastRead).getTime();case"namedes":return t.title.toUpperCase()===n.title.toUpperCase()?0:n.title.toUpperCase()>t.title.toUpperCase()?1:-1;case"nameasc":return t.title.toUpperCase()===n.title.toUpperCase()?0:t.title.toUpperCase()>n.title.toUpperCase()?1:-1}},k=n(68),w=0,y={textAlign:"center"},U=function(){var e=Object(c.useState)([]),t=Object(s.a)(e,2),n=t[0],a=t[1],r=Object(c.useState)("reading"),i=Object(s.a)(r,2),o=i[0],j=i[1],u=Object(c.useState)(""),b=Object(s.a)(u,2),x=b[0],g=b[1],U=Object(c.useState)("timedes"),D=Object(s.a)(U,2),T=D[0],I=D[1],L=Object(c.useState)(!1),A=Object(s.a)(L,2),M=A[0],N=A[1],E=d();Object(c.useEffect)((function(){var e=d();l.a.get("/api/manga",e).then((function(e){a(e.data)}))}),[o,x]);var F=function(e){clearTimeout(w),w=setTimeout((function(){g("")}),2500),g(e)};return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("div",{children:[Object(O.jsxs)("div",{children:[Object(O.jsx)("button",{onClick:function(){return j("reading")},children:"Reading"}),Object(O.jsx)("button",{onClick:function(){return j("to start")},children:"To start"}),Object(O.jsx)("button",{onClick:function(){return j("finished")},children:"Finished"}),Object(O.jsx)("button",{onClick:function(){return j("on hold")},children:"On hold"}),Object(O.jsx)("button",{onClick:function(){return j("")},children:"All"}),"\xa0 currently viewing: \xa0 ",o||"All"]}),Object(O.jsx)(k.a,{children:Object(O.jsxs)("tbody",{children:[Object(O.jsxs)("tr",{style:y,children:[Object(O.jsx)("th",{children:Object(O.jsx)("h3",{children:"Title"})}),Object(O.jsx)("th",{children:Object(O.jsx)("h3",{children:"Last Read"})}),Object(O.jsx)("th",{children:Object(O.jsx)("h3",{children:"Current"})}),Object(O.jsx)("th",{children:"Link"}),Object(O.jsx)("th",{children:"Notes"}),Object(O.jsx)("th",{children:"Status"})]}),n.filter((function(e){return e.status.includes(o)})).sort((function(e,t){return C(T,e,t)})).map((function(e){return Object(O.jsx)(f,{manga:e,alert:function(e){return F(e)}},e._id)}))]})})]}),Object(O.jsxs)("div",{children:[Object(O.jsx)(p,{add:function(e){l.a.post("/api/manga",e,E).then((function(t){a(t.data),F("Added new manga ".concat(e.title))}))}}),Object(O.jsx)(v,{message:x}),Object(O.jsx)(h.a,{onClick:function(){return N(!M)},children:M?"Hide Stats":"Show Stats"}),Object(O.jsx)(m,{data:n,vis:M}),Object(O.jsx)(S,{setSorter:I,sorter:T})]})]})},D=n(18),T=n.n(D),I=n(31),L=n(11),A=function(e){var t=e.onLogin,n=u("text"),c=u("password"),a=function(){var e=Object(I.a)(T.a.mark((function e(a){var r;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.prev=1,e.next=4,L.post("/api/login",{username:n.value,password:c.value});case 4:r=e.sent,window.localStorage.setItem("loggedInUser",JSON.stringify(r.data)),t(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.log(a);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}();return Object(O.jsxs)("div",{className:"container",children:[Object(O.jsx)("h2",{children:"Login"}),Object(O.jsx)(g.a,{onSubmit:a,children:Object(O.jsxs)(g.a.Group,{children:[Object(O.jsx)(g.a.Label,{children:"Username"}),Object(O.jsx)(g.a.Control,Object(j.a)({},n)),Object(O.jsx)("br",{}),Object(O.jsx)(g.a.Label,{children:"Password"}),Object(O.jsx)(g.a.Control,Object(j.a)({},c)),Object(O.jsx)("br",{}),Object(O.jsx)(h.a,{type:"submit",children:"Login"})]})})]})},M=function(){var e=Object(c.useState)("loading..."),t=Object(s.a)(e,2),n=t[0],a=t[1];Object(c.useEffect)((function(){try{var e=localStorage.getItem("loggedInUser"),t={headers:{Authorization:"bearer ".concat(JSON.parse(e).token)}};l.a.get("/api/users/verify",t).then((function(t){"valid"===t.data?a(JSON.parse(e)):a(null)})).catch((function(e){a(null)}))}catch(n){a(null)}}),[]);return Object(O.jsx)(O.Fragment,{children:n?"loading..."===n?Object(O.jsx)("p",{children:n}):Object(O.jsxs)("div",{className:"container",children:[Object(O.jsx)("h1",{children:"Manga Tracker"}),Object(O.jsxs)("p",{children:["Logged in as 'user name' ",Object(O.jsx)(h.a,{onClick:function(){return localStorage.removeItem("loggedInUser"),void a(null)},children:"logout"})]}),Object(O.jsx)(U,{})]}):Object(O.jsx)(A,{onLogin:function(){var e=localStorage.getItem("loggedInUser");e&&a(JSON.parse(e))}})})};r.a.render(Object(O.jsx)(i.a,{children:Object(O.jsx)(M,{})}),document.getElementById("root"))}},[[67,1,2]]]);
//# sourceMappingURL=main.505bbff9.chunk.js.map